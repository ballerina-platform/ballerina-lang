apply from: "$rootDir/gradle/javaProject.gradle"
apply plugin: 'com.github.johnrengelman.shadow'

dependencies {
    implementation project(':ballerina-lang')
    implementation project(':ballerina-core')
    implementation project(':ballerina-runtime')
    implementation project(':ballerina-launcher')
    implementation project(':ballerina-backend-jvm')

    implementation 'org.javassist:javassist'
    implementation 'io.netty:netty-codec-http'
    implementation 'org.apache.commons:commons-lang3'
    implementation 'org.wso2.transport.http:org.wso2.transport.http.netty'
    implementation 'org.testng:testng'
}

configurations {
    commonBackend
}

jar {
    enabled = false
    dependsOn(shadowJar { classifier = null })
    manifest {
        attributes(
                'Implementation-Title': 'Ballerina - Test Utils',
                'Implementation-Version': version,
                'Premain-Class': 'org.ballerinalang.test.agent.BallerinaServerAgent'
        )
    }
}

shadowJar {
    configurations = [project.configurations.runtimeClasspath]
    dependencies {
        exclude(dependency('org.slf4j:slf4j-api'))
        exclude(dependency('org.apache.commons:commons-lang3'))
        exclude(dependency('org.wso2.transport.http:org.wso2.transport.http.netty'))
        exclude(dependency('org.wso2.eclipse.osgi:org.eclipse.osgi'))
        exclude(dependency('org.wso2.eclipse.osgi:org.eclipse.osgi.services'))
        exclude(dependency('org.slf4j:slf4j-log4j12'))
        exclude(dependency('org.codehaus.woodstox:woodstox-core-asl'))
        exclude(dependency('org.codehaus.woodstox:stax2-api'))
        exclude(dependency('io.netty:netty-common'))
        exclude(dependency('io.netty:netty-buffer'))
        exclude(dependency('io.netty:netty-transport'))
        exclude(dependency('io.netty:netty-handler'))
        exclude(dependency('io.netty:netty-codec'))
        exclude(dependency('io.netty:netty-handler-proxy'))
        exclude(dependency('io.netty:netty-codec-socks'))
        exclude(dependency('io.netty:netty-codec-http2'))
        exclude(dependency('io.netty:netty-resolver'))
        exclude(dependency('commons-pool.wso2:commons-pool'))
        exclude(dependency('commons-pool:commons-pool'))
        exclude(dependency('org.wso2.orbit.org.yaml:snakeyaml'))
        exclude(dependency('org.bouncycastle:bcprov-jdk15on'))
        exclude(dependency('org.bouncycastle:bcpkix-jdk15on'))
        exclude(dependency('io.netty:netty-tcnative-boringssl-static'))
        exclude(dependency('org.testng:testng'))
        exclude(dependency('com.beust:jcommander'))
        exclude(dependency('io.netty:netty-codec-http'))
        exclude(dependency('io.netty:netty-transport-native-unix-common'))
        exclude('META-INF/*.SF')
        exclude('META-INF/*.DSA')
        exclude('META-INF/*.RSA')
    }
}

artifacts {
    commonBackend file: file('src/main/ballerina/httpService/common_backend.bal')
}

build.dependsOn shadowJar
