/*!
 * Copyright (c) 2018, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 *
 */

@type    : "view";
@element : "diagram";

@import (multiple) '../../ballerina.config';

.diagram(@color) {
    background: ~"@{@{color}-diagram-background-color}";
    display: inline-block;
    min-width: 100%;
    
    .status-wrapper {
        width: auto;
        right: 70px;
        top: 30px;
        position: fixed;
        justify-content: right;
        z-index: 0;
        font-size: 14px;
        font-weight: 300;
        padding: 0 10px;
        z-index: 0;
        border-width: 1px 0 1px 1px;
        border-style: solid;
        border-color: #e9e9e9; 
        background: ~"@{@{color}-diagram-background-color}";
        cursor: pointer;

        .label {
            background: ~"@{@{color}-diagram-background-color}";
            padding: 10px 5px 10px 0;
            font-size: 14px;
            font-weight: 300;
            cursor: pointer;
        }
        p {
            margin: 0; 
            line-height: 0;
        }
        &:hover {
            cursor: pointer;
        }
    }
    .menu-icon {
        font-size: 20px;
        color: #f1f1f1;
        position: fixed;
        right: 2em;
        cursor: pointer;
        border: 1px solid #e8e8e8;
        padding: 6px 4px;
        text-align: center;
        width: 40px;
        border-radius: 54%;
        background: #333;
        margin-right: 0;
        z-index: 1000;
        top: 1.4em;

        .icon {
            margin: 3.5px;
            cursor: pointer;
        }

        &:hover {
            opacity: 0.7;
            cursor: pointer;
        }
    }

    .ui.grid {
        padding-top: 0;

        &.menu-container {
            width: 410px;
            height: auto;
            box-shadow: 3px 3px 0px 0px rgba(238,238,238,0.75);
            -webkit-box-shadow: 3px 3px 0px 0px rgba(238,238,238,0.75);
            -moz-box-shadow: 3px 3px 0px 0px rgba(238,238,238,0.75);
            border: 1px solid #ccc;
            margin-right: 2px;
            position: fixed;
            right: 2em;
            top: 1.4em;
            background: ~"@{@{color}-diagram-background-color}";
            z-index: 1000;
            padding-top: 0;
            margin-top: 0;

            .menu-row {
                margin: 0;
                padding: 0 5px;
                height: 34px;
                margin: 5px 0;

                .menu-label {
                    font-weight: 500;
                    padding-top: 7px;
                }

                .selection-row {
                    background: ~"@{@{color}-diagram-menu-row-background}";
                    padding: 7px 0;
                    height: 30px;
                    display: inline-flex;

                    .menu-dropdown-small {
                        background: ~"@{@{color}-diagram-menu-dropdown-background}";
                        width: 100px;
                        height: auto;
                        padding: 10px;
                        height: 30px;
                        margin-top: -7px;
                        .text { 
                            width: 100px;
                        }
                        .icon {
                            width: 10px;
                            padding: 0;
                            font-size: 10px;
                        }
                        &.label {
                            font-weight: 500;
                            color: #333;
                            overflow: hidden;
                            height: 30px;
                            top: -4px;
                        }
                        &.dropdown {
                            height: 30px;
                            padding-top: 7px;
                            width: 160px;

                            .item {
                                width: 158px;
                            }
                        }
                    }
                    .icon {
                        font-size: 12px;
                        width: 30px;
                        margin-left: 5px; 
                        cursor: pointer;
                        padding-bottom: 10px;
                        display: inline-flex;
                        margin-left: 10px;

                        &:hover {
                            color: #868686;
                        }
                    }
                    .menu-dropdown-mid {
                        background: ~"@{@{color}-diagram-menu-dropdown-background}";
                        width: 222px;
                        height: auto;
                        padding: 10px;
                        height: 30px;
                        margin-top: -7px;
                        .item {
                            width: 220px;
                        }
                        .text { 
                            width: 180px;
                            overflow: hidden;
                            text-overflow: ellipsis;
                            white-space: nowrap;
                            margin-top: -5px;
                        }
                        .icon {
                            padding:0;
                            width: 10px;
                            font-size: 10px;
                            top: -4px;
                        }
                    }
                    .ui.dropdown .menu {
                        box-shadow: none;
                        width:148px
                    }
                }
                .menu-control {
                    padding: 0;
                    
                    .icon {
                        font-size: 12px;
                        width: 30px;
                        margin-top: 8px; 

                        &:hover {
                            cursor: pointer;
                        }
                    }
                }
            }
        }
    }
    
    .diagram-container {
        background: ~"@{@{color}-diagram-background-color}";
        height: 110vh;

        text {
            fill: ~"@{@{color}-diagram-base-text-color}";
            dominant-baseline: central;
            cursor: default;
            &.editable {
                cursor: text;
            }
            -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
            -khtml-user-select: none; /* Konqueror HTML */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently supported by Chrome and Opera */
        }
        .diagram-canvas {
            font-family: @diagram-font;
            font-size: @diagram-font-size;
            width: 100%;
            height: 110vh;
            outline: none;

            .panel-group-header {
                fill: ~"@{@{color}-diagram-panel-header-background-color}";

                .panel-icon {
                    font-family: @iconFont;
                }
                text {
                    fill: ~"@{@{color}-diagram-panel-header-text-color}";
                    font-size: 18px;
                }
            }
            
            .panel {
                .match{
                    line{
                        stroke: ~"@{@{color}-diagram-expanded-func-frame-color}";
                        stroke-width: 1px;
                    }
                    text {
                        fill: ~"@{@{color}-diagram-panel-header-text-color}";
                    }
                    polygon{
                        stroke: ~"@{@{color}-diagram-expanded-func-frame-color}";
                        stroke-width: 1px;
                    }
                }
                .frame-border {
                    fill: none;
                    stroke-width: 1px;
                    stroke: ~"@{@{color}-diagram-expanded-func-frame-color}";
                }
                .statement {
                    pointer-events: all;
                }
                .hidden-block {
                    stroke: ~"@{@{color}-diagram-life-line-worker-stroke-color}";
                    stroke-width: 2px;
                    fill:@diagram-base-light-color;
                    cursor: pointer;
                }
                .panel-header {
                    fill: ~"@{@{color}-diagram-panel-header-background-color}";

                    .panel-icon {
                        font-family: @iconFont;
                    }
                    text {
                        fill: ~"@{@{color}-diagram-panel-header-text-color}";
                        font-size: @diagram-life-line-head-font-size;
                    }
                }
                .panel-body {
                    fill: ~"@{@{color}-diagram-panel-body-background-color}";

                    .client-line {
                        stroke: ~"@{@{color}-diagram-client-line-stroke-color}";
                        stroke-width: @diagram-client-line-stroke-width;
                    }
                    
                    .life-line {
                        stroke: ~"@{@{color}-diagram-life-line-stroke-color}";
                        stroke-width: @diagram-life-line-stroke-width;

                        rect {
                            fill: ~"@{@{color}-diagram-life-line-head-background-color}";
                            stroke: ~"@{@{color}-diagram-life-line-head-stroke-color}";
                            stroke-width: 0; 
                        }
                        text {
                            fill: ~"@{@{color}-diagram-life-line-text-color}";
                            stroke-width: 0;
                            text-anchor: middle;
                        }

                        &.life-line-worker {
                            stroke:  ~"@{@{color}-diagram-life-line-worker-stroke-color}";
                            color: ~"@{@{color}-diagram-life-line-worker-stroke-color}";
                            stroke-width: 2px;

                            .life-line-wrapper {
                                stroke: ~"@{@{color}-diagram-life-line-worker-stroke-color}";
                                stroke-width: 2px;
                                fill:#fff;
                            }
                            .source-linked-label {
                                font-size: 1.2rem;
                            }
                            .icon-wrapper {
                                fill: ~"@{@{color}-diagram-life-line-worker-stroke-color}";
                                stroke: none;
                            }
                            .life-line-icon {
                                fill: #fff;
                            }
                            rect {
                                fill: ~"@{@{color}-diagram-life-line-worker-stroke-color}";
                            }
                            text {
                                fill: ~"@{@{color}-diagram-life-line-worker-stroke-color}";
                            }
                        }
                        &.life-line-endpoint {
                            stroke: ~"@{@{color}-diagram-life-line-endpoint-stroke-color}";
                            color: ~"@{@{color}-diagram-life-line-endpoint-stroke-color}";
                            stroke-width: 2px;

                            .life-line-wrapper {
                                stroke: ~"@{@{color}-diagram-life-line-endpoint-stroke-color}";
                                stroke-width: 2px;
                                fill:#fff;
                            }
                            .source-linked-label {
                                font-size: 1.2rem;
                            }
                            .icon-wrapper {
                                fill: ~"@{@{color}-diagram-life-line-endpoint-stroke-color}";
                                stroke: none;
                            }
                            .life-line-icon {
                                fill: #fff;
                            }
                            rect {
                                fill: ~"@{@{color}-diagram-life-line-endpoint-stroke-color}";
                            }
                            text {
                                fill: ~"@{@{color}-diagram-life-line-endpoint-stroke-color}";
                            }
                        }
                    }
                    .life-line-endpoint-activity {
                        fill: ~"@{@{color}-diagram-life-line-endpoint-stroke-activity-color}";
                    }
                    .arrow-head {
                        fill: ~"@{@{color}-diagram-arrow-head-color}";
                    }
                    .statement {
                        font-size: @diagram-statement-font-size;
                        .expander {
                            visibility: hidden;
                            .circle {
                                fill: ~"@{@{color}-diagram-expanded-func-frame-color}";
                                cursor: pointer;
                            }
                            text {
                                cursor: pointer;
                            }
                            &:hover {
                                visibility: visible;
                            }
                        }
                    }
                    .action-invocation {
                        line {
                            stroke:  ~"@{@{color}-diagram-life-line-endpoint-stroke-color}";
                            stroke-width: 2px;
                        }
                        fill: ~"@{@{color}-diagram-arrow-head-color}";
                        .invoke-line {
                            stroke:~"@{@{color}-diagram-life-line-endpoint-stroke-color}";
                            stroke-width: 2px;
                        }
                        .invoke-arrowhead {
                            stroke: ~"@{@{color}-diagram-life-line-endpoint-stroke-color}";
                            fill: ~"@{@{color}-diagram-life-line-endpoint-stroke-color}";
                            stroke-width: 0;
                        }
                    }
                    .start-invocation {
                        line {
                            stroke: ~"@{@{color}-diagram-arrow-head-color}";
                            stroke-width: 2px;
                        }
                    }
                    .condition {
                        .condition-case {
                            font-style: italic;
                        }
                        .condition-case-background {
                            fill: ~"@{@{color}-diagram-condition-case-background-color}";
                        }
                        .label {
                            text-anchor: middle;
                        }
                        polyline {
                            fill: ~"@{@{color}-diagram-condition-background-color}";
                            stroke: @purple;
                            stroke-width: @diagram-condition-stroke-width;
                        }
                    }
                    .condition-line {
                        fill: transparent;
                        stroke: ~"@{@{color}-diagram-condition-line-stroke-color}";
                        stroke-width: @diagram-condition-line-stroke-width;
                    }
                    .condition-block {
                        .condition-arrow-head {
                            fill: ~"@{@{color}-diagram-condition-line-worker-arrow-head-color}";
                        }
                    }
                    .hide-line {
                        stroke: ~"@{@{color}-diagram-panel-body-background-color}";
                        stroke-width: 2px;
                    }
                    .expanded-func {
                        .frame {
                            stroke: ~"@{@{color}-diagram-expanded-func-frame-color}";
                            fill: none;
                        }
                        .func-name {
                            font-weight: bold;
                        }
                        .collapser {
                            cursor: pointer;
                            fill: ~"@{@{color}-diagram-collapse-func-color}";
                            font-size: 12px;
                        }
                        .life-line {
                            stroke: ~"@{@{color}-diagram-condition-line-stroke-color}";
                            stroke-width: @diagram-life-line-stroke-width;
                        }
                    }
                    .expanded-hidden-block {
                        .frame {
                            stroke: #b3b3b3;
                            fill: none;
                            stroke-width: 1.5;
                        }
                        .collapser {
                            stroke: ~"@{@{color}-diagram-collapse-func-color}";
                            stroke-width: 0;
                            cursor: pointer;
                            fill: ~"@{@{color}-diagram-collapse-func-color}";
                            font-size: 12px;
                        }
                    }
                }
                .worker-block-container {
                    .hover-rect {
                        pointer-events: painted;
                    }
                }
            }

            .svg-dropdown-menu {
                &.block-dropdown {
                    display: none;
                    
                    &.hover,
                    &.active {
                        display: block;
                    }
                }
                .trigger {
                    fill: ~"@{@{color}-diagram-menu-trigger-background-color}";

                    text {
                        fill: ~"@{@{color}-diagram-menu-trigger-text-color}";
                    }
                }
                .content {
                    .item {
                        cursor: pointer;
                        fill: ~"@{@{color}-diagram-menu-item-background-color}";

                        text {
                            cursor: pointer;
                            fill: ~"@{@{color}-diagram-menu-item-text-color}";
                        }
                        &:hover {
                            .item-body {
                                fill: ~"@{@{color}-diagram-menu-item-hover-background-color}";
                            }
                        }
                    }
                }
            }
            .source-linked-label {
                &:hover {
                    text-decoration: underline;
                    cursor: pointer;
                }
            }
        }
        
        .diagram-controllers {
            .ui.menu.top-menu {
                padding: 10px;
                width: 100%;
                background: ~"@{@{color}-diagram-top-menu-background-color}";

                .item {
                    padding: 0;
                    margin-right: 5px;
                }
                .button {
                    z-index: 1;
                }
            }
        }
    }
    .endpoint-search-dialog {
        top: 15px;
    }
}

body.diagram {
    .diagram("light");
}

.loadUIOverrides();
