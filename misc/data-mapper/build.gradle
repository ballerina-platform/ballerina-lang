plugins {
    id 'java'
    id "com.github.spotbugs" version "1.6.10"
    id "de.undercouch.download" version "3.4.3"
    id 'base'
    id 'maven-publish'
    id 'net.researchgate.release' version '2.6.0'
}

group 'DataMapper'
version '0.1.0-SNAPSHOT'

sourceCompatibility = 1.8


allprojects {
    repositories {
        mavenCentral()
        maven { url "https://maven.wso2.org/nexus/content/repositories/snapshots/" }
        maven { url "http://maven.wso2.org/nexus/content/repositories/releases/" }
        maven { url "http://maven.wso2.org/nexus/content/groups/wso2-public/" }
    }

    dependencies {
        testCompile group: 'junit', name: 'junit', version: '4.12'
        implementation('org.ballerinalang:language-server-core:1.2.0')
        implementation('org.ballerinalang:language-server-commons:1.2.0')
        implementation('org.ballerinalang:language-server-compiler:1.2.0')
        implementation('org.ballerinalang:language-server-cli:1.2.0')
        implementation('org.ballerinalang:ballerina-lang:1.2.0')
        implementation('org.ballerinalang:ballerina-runtime:1.2.0')
        implementation 'org.apache.commons:commons-lang3:3.6'
        implementation(group: 'org.eclipse.lsp4j', name: 'org.eclipse.lsp4j', version: '0.8.1')
        compile 'org.apache.directory.studio:org.apache.commons.io:2.4'
        compile 'com.fasterxml.jackson.core:jackson-databind:2.1.2'
    }
}

apply plugin: "com.github.spotbugs"

spotbugsMain {
    it.effort "max"
    it.reportLevel "low"
    it.reports {
        xml.enabled false
        html.enabled true
    }
    def excludeFile = file('spotbugs-exclude.xml')
    if(excludeFile.exists()) {
        it.excludeFilter = excludeFile
    }
}

apply plugin: 'checkstyle'

checkstyle {
    toolVersion '8.18'
    configFile rootProject.file("build-config/checkstyle/checkstyle.xml")
}

subprojects {
apply plugin: 'maven-publish'
publishing {
    publications {
        mavenJava(MavenPublication) {
            groupId project.group
            artifactId project.name
            version = project.version
        }
    }
    repositories {
        maven {
            if(project.version.endsWith('-SNAPSHOT')) {
                url "https://maven.wso2.org/nexus/content/repositories/snapshots/"
            } else {
                url "https://maven.wso2.org/nexus/service/local/staging/deploy/maven2/"
            }
            credentials {
                username System.getenv("NEXUS_USERNAME")
                password System.getenv("NEXUS_PASSWORD")
            }
        }
    }
}

release {
    // Disable check snapshots temporarily
    failOnSnapshotDependencies = false
    failOnCommitNeeded = false
    tagTemplate = 'v${version}'
    git {
        // To release from any branch
        requireBranch = null
    }
}

afterReleaseBuild.dependsOn publishToMavenLocal
afterReleaseBuild.dependsOn publish
}
